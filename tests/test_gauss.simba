program gauss_test;

{$i srl/shared/gauss.simba}

type
  TMode = (g_circle, g_box, g_gauss);

const
  Tries = 10;
  Mode = g_gauss;
  animated = False;

var
  img: Integer;

procedure doCircle();
const
  mid: TPoint = [250, 250];
  rad = 200;
var
  tpa: TPointArray;
  p: TPoint;
begin
  tpa := TPAFromCircle(mid.x, mid.y, rad);
  DrawTPABitmap(img, tpa, 255);

  for 0 to Tries do
  begin
    if (animated) then
    begin
      DrawBitmapDebugImg(img);
      Wait(1);
    end;

    gaussPoint(mid.x, mid.y, 0.00, 360.0, rad, p.x, p.y);
    DrawTPABitmap(img, [[p.x, p.y]], 643836);
  end;
end;

procedure doBox();
const
  box: TBox = [100, 100, 400, 400];
var
  tpa: TPointArray;
  p: TPoint;
begin
  DrawTPABitmap(img, TPABorder(TPAFromBox(box)), 255);

  for 0 to Tries do
  begin
    if (animated) then
    begin
      DrawBitmapDebugImg(img);
      Wait(1);
    end;

    gaussBox(p, box);
    DrawTPABitmap(img, [p], 643836);
  end;
end;

procedure doGauss();
var
  a: array[0..Tries] of Extended;
  i: Integer;
begin
  for i := 0 to High(a) do
    a[i] := gauss;

  Writeln(AverageExtended(a));
end;

begin
  img := CreateBitmap(500, 500);
  ShowBitmap(img);

  case (Mode) of
    g_circle: doCircle();
    g_box: doBox();
    g_gauss: doGauss();
  end;

  ShowBitmap(img);
  FreeBitmap(img);
end.
