{$i srl/shared.simba}

var
  circle: TPointArray;
  img: Integer;
  w, h: Integer;
  s, e: TPoint;
  b: TBox = [1, 600, 99, 699];

const
  dyn_Target: TPoint = [600, 100];
var
  dyn_Moved: Boolean = False;

procedure Dynamic_Hook_OnMove(Sender: TObject; Shift: TShiftState; X, Y: Integer);
begin
  if (dyn_Moved) then
    FastSetPixel(img, X, Y, 255)
  else
    FastSetPixel(img, X, Y, 15773440);
end;

procedure Dynamic_Hook(Sender: TObject; var xs, ys, xe, ye: Extended);
begin
  if (Distance(Round(xs), Round(ys), dyn_Target.x, dyn_Target.y) < 200) then
  begin
    dyn_Moved := True;
    ye := 500 + Random(-100, 100);
  end;
end;

procedure Test_Dynamic;
begin
  Mouse.setMode(mouse_Brake);
  Mouse.setOnMouseMove(@Dynamic_Hook_OnMove);
  Mouse.SetOnSplineCreate(@Dynamic_Hook);

  MoveMouse(100, 100);
  Mouse.Move(dyn_Target);
end;


procedure Hook(Sender: TObject; Shift: TShiftState; X, Y: Integer);
var
  c: Integer = 255;
begin
  if (Mouse.getMode() = mouse_Brake) then
    c := 3453454
  else if (Mouse.getMode() = mouse_Human) then
    c := 14811135;
  try FastSetPixel(img, X, Y, c); except end;
end;

procedure Mouse_Event(Sender: TObject; Button: TMouseButton; Shift: TShiftState; X, Y: Integer);
begin
  Writeln('Event ', Button);
end;

begin
  img := CreateBitmap(800, 800);

  Test_Dynamic();

  ShowBitmap(img);
  FreeBitmap(img);

  {GetClientDimensions(w, h);
  img := CreateBitmap(800, 900);

  Mouse.setOnMouseMove(@Hook);
  Mouse.setOnMouseEvent(@Mouse_Event);

  s.x := 100;
  e.x := 600;
  s.y := 100;
  e.y := 150;

  Mouse.setMode(mouse_Brake);
  Mouse.setPosition(s);
  Mouse.Move(e);

  s.y := 300;
  e.y := 350;

  Mouse.setMode(mouse_Human);
  Mouse.setPosition(s);
  Mouse.Move(e);

  s.y := 500;
  e.y := 550;

  Mouse.setMode(mouse_Accurate);
  Mouse.setPosition(s);
  Mouse.Move(e);

  RectangleBitmapEx(img, b, 2654556, 0.50);
  Mouse.setPosition(Point(b.X1, b.Y1));
  Mouse.setMode(mouse_Human);
  Mouse.Move(b);

  s.y := 750;
  e.y := 800;

  Mouse.setMode(mouse_Human);
  Mouse.setPosition(s);
  Mouse.Miss(e, True);


  circle := TPAFromCircle(200, 650, 45);
  FillEllipse(circle);
  DrawTPABitmap(img, circle, FastGetPixel(img, b.x2, b.y2));
  Mouse.setPosition(Point(150, 600));
  Mouse.Move(Point(200, 650), 45);

  // Mouse.Click(Point(245, 504), mouse_Left);

  ShowBitmap(img);
  FreeBitmap(img); }
end;
